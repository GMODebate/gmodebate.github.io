window.gdpr(function(){$async({src:"https://www.googletagmanager.com/gtag/js?id=B2BVVHSP0R"});var e=localStorage.getItem("u"),t=!!(t=document.querySelector('meta[http-equiv="content-language"]'))&&t.getAttribute("data-u");(!e||t&&parseInt(t)>parseInt(e))&&(localStorage.clear(),console.warn("localStorage cleared",t,e),localStorage.setItem("u",t||1))}),function(k,w){var v,V,l,u,X,x,Q,a,t,s,n,c,_,W,G,L,Z,ee,te,ne,ae,A,T,I,re,ie,oe,ce,S,e,r,p,h,i,m=w.addEventListener,E=w.documentElement,g=w.head,d={chapter:!1,subchapter:!1,prev:!1,next:!1},se="localStorage"in k&&k.localStorage,y=/^h[0-9]{1}$/i,le=/(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([^&?\/]{11})/,ue=k.innerHeight,de=k.matchMedia("(prefers-color-scheme: dark)"),fe=!!de.matches,pe=navigator?navigator.userAgent:0,he=".webp",me=/(\.(jp(e)?g|gif|bmp|png|tiff))/gi,o=!(!(pe&&(pe=pe.match(/.*\bChrome\/([0-9\.]+)|.*\bFirefox\/(\d+)\b.*/))&&(pe[1]||pe[2]&&65<=parseInt(pe[2])))&&(h=[],p=!0,(i=new Image).onload=i.onerror=function(){o=0<i.height,p=!1,PROCESS_CALLBACK_QUEUE(h,o)},i.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"));function ge(){console.error.apply(console,Ee(arguments))}function ve(){console.log.apply(console,Ee(arguments))}function be(){}be.prototype={on:function(e,t,n){var a;return O(e)?e.forEach(function(e){Ie(e,t,n)}):((a=this.e||(this.e={}))[e]||(a[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var a=this;function r(){a.off(e,r),t.apply(n,arguments)}return r._=t,this.on(e,r,n)},emit:function(e){for(var t=Ee(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),a=0,r=n.length;a<r;a++)n[a].fn.apply(n[a].ctx,t);return this},off:function(e,t){if(O(e))e.forEach(function(e){Se(e,t,ctx)});else{var n=this.e||(this.e={}),a=n[e],r=[];if(a&&t)for(var i=0,o=a.length;i<o;i++)a[i].fn!==t&&a[i].fn._!==t&&r.push(a[i]);r.length?n[e]=r:delete n[e]}return this}};function q(){Te.emit.apply(Te,arguments)}var ye,M,N,ke,we,H,xe,_e,Le,Ae,Te=new be,Ie=function(){Te.on.apply(Te,arguments)},Se=function(){Te.off.apply(Te,arguments)};function Ee(e,t){return t=t||0,Array.prototype.slice.call(e,t)}function qe(e,t,n){return n=e.nextElementSibling,1<(t=t||1)?qe(n,--t):n}function Me(e,t){J(e).insertBefore(t,e)}function Ne(e,t,n){(n=qe(e))?Me(n,t):b(J(e),t)}function O(e){return e instanceof Array}function He(e){return"string"==typeof e}function j(e,t,n,a){a=(a=a||document).createElement(e);return t&&$(a,t),Oe(a,n),a}function C(e,t,n){return e?(e=e.cloneNode(!0),t&&$(e,t),Oe(e,n),e):0}function Oe(e,t){if(t){O(t)||(t=[t]),O(t)||(t=[t]),ye=ye||C(ut);for(var n=0,a=t.length;n<a;n++)if(He(t[n]))for(ye.innerHTML=t[n];Fe(ye);)b(e,Fe(ye));else b(e,t[n])}}function je(e){var t=(new DOMParser).parseFromString(e,"text/html");return b(e=document.createDocumentFragment(),Ee(t.body.childNodes)),e}function b(e,t){for(var n=0,a=(t=O(t)?t:[t]).length;n<a;n++)t[n]&&(He(t[n])&&(t[n]=at(t[n])),e.appendChild(t[n]))}function Ce(e,t){(t=J(e))&&t.removeChild(e)}function Fe(e){return e.firstChild}function De(e,t,n,a,r){a=F(e,function(){r||(a(),t.apply(null,arguments))},n,{passive:!0,once:!0})}function F(a,r,n,i){try{return n=n||document,-1===i&&(i={passive:!0,once:!0}),O(a)?K(a,function(e,t){F(t,r,n,i)}):K(n=O(n)||n instanceof NodeList?n:[n],function(e,t,n){if(m)n=-1!==["touchstart"].indexOf(a),t.addEventListener(a,r,n?Object.assign({passive:!0},i||{}):i||!1);else if(t.attachEvent)"DOMContentLoaded"===a&&(a="load",t=window),t.attachEvent("on"+a,r);else try{t["on"+a]=r}catch(e){}}),function(){return function n(a,r,i){i=i||w,O(a)?K(a,function(e,t){n(t,r,i)}):K(i=O(i)||i instanceof NodeList?i:[i],function(e,t){m?t.removeEventListener(a,r,!1):i.attachEvent&&t.detachEvent("on"+a,r)})}(a,r,n)}}catch(e){ge(e)}}function ze(e,t,n,a){if(void 0===t&&(t=e?20:0),-1===e){var r=w.location.hash.split("#")[1];if(r&&!(e=w.getElementById(r)))return}a=e?e.getBoundingClientRect().top-t+k.scrollY:t,n&&"object"==typeof n||(n={behavior:"smooth"}),k.scrollTo(Object.assign({left:0,top:a},n))}function D(e,t,n,a){a=!1;for(var r=0,i=(t=O(t)?t:[t]).length;r<i;r++)if(e.classList.contains(t[r])){if(a=!0,n)return a}else if(!n)return!1;return a}function z(e,t,n){for(var a,r=0,i=(t=O(t)?t:[t]).length;r<i;r++)a=t[r],n?e.classList.remove(a):e.classList.add(a)}function O(e){return e instanceof Array}function f(e,t,n){!t&&""!==t||(e.innerHTML=t),isNaN(n)?e.removeAttribute("data-index",n):e.setAttribute("data-index",n)}function P(e,t,n){return"link"===e.type&&e.chapterTitle?e.chapterTitle:(n=e.chapterTitle||e.innerHTML,!1!==t&&e.chapterIndex?e.chapterIndex+" "+n:n)}function B(e,t){return t=!!e&&parseInt(e.getAttribute("data-index")),!isNaN(t)&&t}function Pe(e,t){var n;R(!1),e="object"==typeof e?B(e):e,isNaN(e)||!1===e||(we&&clearTimeout(we),H&&(H(),H=!1),t=x[e],(e=(X=t).readerInfo)&&e.expand&&(n=Y(e.expand))&&(lt(n,!0),e.expand=!1),Re(t),V=!0,H=F("scroll",function(e){we&&clearTimeout(we),we=setTimeout(function(){V=!1,H(),H=!1},1e3)},k),ze(t,80),n=t.chapterTitleText||t.innerText,k.history&&k.history.pushState("",n,w.location.pathname+"#"+t.id),w.title=n)}function Be(){var a=null,r=Number.MAX_VALUE;x.forEach(function(e){var t=e.getBoundingClientRect(),n=window.innerHeight-t.bottom;t.top<window.innerHeight&&n<r&&(a=e,r=n)}),Re(a)}function Re(s){xe&&clearTimeout(xe),xe=setTimeout(function(){s?(l=x.slice(x.indexOf(s)+1).shift(),u=x.slice(0,x.indexOf(s)).pop(),n=s.classList.contains("subchapter")||"link"===s.type||s.readerInfo&&s.readerInfo.subchapter?(t=s,e=x.lastIndexOf(t),x.slice(0,e).filter(function(e){return!(!e.readerInfo||!e.readerInfo.chapter)||e.classList.contains("chapter")}).pop()):s):u=l=!1,n&&(a=n.id),t&&(r=t.id),u&&(i=u.id),l&&(o=l.id);var t,e,n,a,r,i,o,c=(c=t?t.index:!!n&&n.index)&&parseInt(c);requestAnimationFrame(function(){ce.forEach(function(e,t){t=parseInt(e.getAttribute("data-index")),c===t?e.parentElement.classList.add("active"):e.parentElement.classList.remove("active")})}),d.chapter===a&&d.subchapter===r&&d.prev===i&&d.next===o||(d.chapter=!!n&&n.id,d.subchapter=!!t&&t.id,d.prev=!!u&&u.id,d.next=!!l&&l.id,requestAnimationFrame(function(){var e;n?(f(ne,P(n),n.index),t?(f(ae,P(t),t.index),te.classList.remove("no-subchapter")):(f(ae),te.classList.add("no-subchapter"))):(ne.innerHTML=Z,f(ne,Z),f(ae),te.classList.add("no-subchapter"),l=x[0]),u?(T.setAttribute("title",u.innerText),f(T,!1,x.indexOf(u)),T.href="#"+(u.id||""),A.classList.remove("no-prev")):(f(T),T.href="#",A.classList.add("no-prev")),l?(I.setAttribute("title",l.innerText),f(I,!1,x.indexOf(l)),I.href="#"+(l.id||""),A.classList.remove("no-next"),l.classList.contains("subchapter")||"link"===l.type?(e=x.lastIndexOf(l),(e=x.slice(0,e).filter(function(e){return!(!e.readerInfo||!e.readerInfo.chapter)||e.classList.contains("chapter")}).pop()).id===d.chapter?(f(re,""),A.classList.add("same-chapter")):(f(re,P(e),e.index),A.classList.remove("same-chapter")),f(ie,P(l),l.index),A.classList.remove("no-subchapter")):(f(ie,""),f(re,P(l),l.index),A.classList.add("no-subchapter"),A.classList.remove("same-chapter"))):(f(I),I.href="#",A.classList.add("no-next"))}))},10)}function Ue(){_e||(_e=1,$async("/css/all.min.css").then(function(){}))}function $e(e,t){e&&!Le||(Le=!e,ke?(gtag("event",e?"menu_close":"menu_open",{event_category:"menu",event_label:e?"Close menu":"Open menu"}),requestAnimationFrame(function(){e?E.classList.remove("noscroll"):(Ue(),E.classList.add("noscroll")),M.style.display=e?"none":"block",N.style.display=e?"none":"block",e||Y(".layer",M).scrollTo(0,0),t&&t()})):t&&t())}function Je(e){function t(){e.onclose&&e.onclose(),z(E,["noscroll","reader-win"],!0)}e=Object.assign({class:""},e),M||(M=Y("#gdpr-w"),N=Y("#gdpr-o")),M||((M=j("div")).id="gdpr-w",(N=j("div")).id="gdpr-o"),b(v,M),b(v,N),ke||(ke=!0,F("click",function(e){e.target===N&&t()},N),F("hashchange",function(e){t()},window)),$(M,{class:"popup-w"+(e.class?" "+e.class:""),id:null}),$(N,{class:"popup-o"+(e.class?" "+e.class:""),id:null});var n=Y(".gdpr-i",M);return n&&Ce(n),z(n=C(e.el),"gdpr-i"),n.removeAttribute("id"),b(M,n),F("click",function(e){t()},Y(".close",M)),We([M,N]),z(E,["noscroll","reader-win"]),{i:n,w:M,o:N}}function Ye(r,s){gtag("event",r?"ebook_close":"ebook_open",{event_category:"ebook",event_label:r?"Close ebook print":"Open ebook print"}),R(!1),requestAnimationFrame(function(){function t(){z(c,"loading"),grecaptcha.execute(n)}var e,n,i,o,a,c;r?(z(E,["noscroll","reader-win"],!0),Ge([M,N])):(e=Je({el:Y("#ebook-popup"),class:"ebook-popup light-o",onclose:function(){Ye(!0)}}),Y(".layer",M).scrollTo(0,0),K(Y("img[data-z], [data-anim]",e.i,!0),function(e,t){it(t)}),s&&Y(".ebook-download input",e.i).focus(),i=Y(".direct-download a",e.i).href,o=Y(".ebook-download input",e.i),a=Y(".ebook-download button",e.i),c=J(a),vt(function(e){e=U(a,"data-sitekey"),b(L,a),n=grecaptcha.render(a,{sitekey:e,callback:function(e,t){var a,n,r;""===(t=o.value.trim())?(z(c,"loading",!0),document.location.href=i):(t=t,e=e,a=function(){z(c,"loading",!0),document.location.href=i},Ke||(n=!(Ke=!0),d.chapter&&(r=B(Y("#"+d.chapter)),isNaN(r)||!1===r||((n={}).chapter={id:x[r].id,title:x[r].chapterTitle},d.subchapter&&(r=B(Y("#"+d.subchapter)),isNaN(r)||!1===r||(n.subchapter={id:x[r].id,title:x[r].chapterTitle})))),(r=new FormData).append("action","email"),r.append("email",t),r.append("reading",JSON.stringify(n)),r.append("url",w.location.href.toString()),r.append("g-recaptcha-response",e),fetch("https://email.gmodebate.org/",{method:"POST",body:r}).then(function(e){e.json().then(function(e,t,n){a(),(e&&e.error||!e||!e.ok)&&ge(e)}).catch(function(e){ge(e)})})))},"error-callback":function(){z(c,"loading",!0)}}),Ne(o,a),F("keypress",function(e){"Enter"===e.key&&t()},o)}),F("click",function(e){t()},a))})}k.gdpr||(k.gdpr=function(e){e()});var Ke=!1;function R(e,t,n,a){Ae=!1,requestAnimationFrame(function(){"lg"===e?(L.classList.toggle("show-lg"),L.classList.remove("show-index"),(n=L.classList.contains("show-lg"))&&gtag("event","show_languages",{event_category:"languages",event_label:"Show language menu"})):"index"===e?(L.classList.remove("show-lg"),L.classList.toggle("show-index"),(n=L.classList.contains("show-index"))&&((a=L.querySelector("li.active"))&&a.scrollIntoView({behavior:"smooth",block:"center"}),gtag("event","reader_show_index",{event_category:"reader_index",event_label:"Show index"}))):(L.classList.remove("show-lg"),L.classList.remove("show-index")),n&&(Ae=e),n&&"download_promo"!==e?w.documentElement.classList.add("reader-win"):w.documentElement.classList.remove("reader-win")})}function Ve(n,e,t){e=new IntersectionObserver(function(e){K(e,function(e,t){n(t,t.target)})},e);return t&&Xe(t,e),e}function Xe(e,n,a){K(e=O(e)||e instanceof NodeList?e:[e],function(e,t){a?n.unobserve(t):n.observe(t)})}function Qe(){e||(e=!0,(starbg=new Image).src=st("/images/stars.png",starbg,function(){Ze(v,{"background-image":"url("+starbg.src+")"})}),se.setItem("stars","1"))}function We(e,t,n){n=n||"";for(var a=0,r=(e=O(e)?e:[e]).length;a<r;a++)Ze(e[a],{display:t?"none":n})}function Ge(e){We(e,1)}function Ze(n,e,a){K(e,function(e,t){nt(t)?n.style.removeProperty(e):n.style.setProperty(e,t,a?"":"important")})}function et(){S?(z(Y("#darkswitch .dark"),"active"),z(Y("#darkswitch .light"),"active",!0),gtag("event","dark_on",{event_category:"dark_mode",event_label:"Dark on"})):(z(Y("#darkswitch .light"),"active"),z(Y("#darkswitch .dark"),"active",!0),gtag("event","dark_off",{event_category:"dark_mode",event_label:"Dark off"}))}function tt(){r||(r=!0,console.log("dark theme"),S=!0,z(E,"dark"),async function(e,t){return(t=w.createElement("style")).styleSheet?t.styleSheet.cssText=e:"textContent"in t?t.textContent=e:t.appendChild(at(e)),requestAnimationFrame(function(){b(g,t)}),t}(k.darkcss))}function nt(e){return void 0===e}function at(e,t){if(!t)return document.createTextNode(e);e.textContent=t}async function rt(e,n,t,a,r,i,o,c){var s;t=U(e,"data-z"),c=D(e,"shape"),t?((r=!!S&&U(e,"data-zd"))&&(t=r),s=ot(e,"data-z-nowebp"),(i=(i=(s?t:st(t,e,function(e,t){n&&n(e,t)},!0))||"SRC_EMPTY")instanceof Promise?await i||"SRC_EMPTY":i)!==e.src&&($(e,{src:i}),c)&&Ze(e,{"shape-outside":"url("+i+")"})):(r=function(){Ze(e,{"background-image":"url("+i+")"}),z(e,"anim")},a=!!n,(t=U(e,"data-anim"))&&(i="/images/anim/"+t+".webp",a?r():(De("load",r,t=new Image),t.src=i)))}function it(e,t){requestAnimationFrame(function(){rt(e,t)})}function U(e,t){return e?e.getAttribute(t):void 0}function ot(e,t){return!!e&&e.hasAttribute(t)}function $(n,e,t){var a;if(O(n))for(var r=0,i=n.length;r<i;r++)$(n[r],e);else He(e)&&(a=e,(e={})[a]=t),K(e,function(e,t){null===t?function n(a,r){O(a)?K(a,function(e,t){n(a,r)}):K(r=O(r)?r:[r],function(e,t){a.removeAttribute(t)})}(n,e):n.setAttribute(e,t)})}function ct(e,n){return O(e)?(n=[],K(e,function(e,t){n.push(ct(t))}),Promise.all(n)):new Promise(e)}function st(n,a,r,e,t,i){return o?(i=n.replace(me,he),a&&(a.src===i||a.webp_resolved&&a.webp_resolved===a.src?r&&requestAnimationFrame(function(){r(a.webp_error||null,n,a)}):(De("error",function(e,t){a.src=n,a.webp_resolved=n,a.webp_error=n,r&&r(e,n,a)},a),r&&De("load",function(){a.webp_resolved=i,r(!1,n,a)},a))),i):e&&p?ct(function(e){h.push(function(){e(st(n,a,r))})}):(r&&requestAnimationFrame(function(){r(!0,n,a)}),n)}function J(e,t,n){return n=e.parentElement,1<(t=t||1)?J(n,--t):n}function Y(e,n,a,r){return n=n||document,O(e)?(r=[],K(e,function(e,t){r.push(Y(t,n,a))}),r):a?n.querySelectorAll(e):n.querySelector(e)}function K(e,t){if(O(e))for(var n=0,a=e.length;n<a;n++)t(n,e[n]);else for(var r in e)e.hasOwnProperty(r)&&t(r,e[r])}function lt(e,t){for(var n,a,r=e.parentElement;"BLOCKQUOTE"!==r.nodeName&&a<5;)a++,r=e.parentElement;(n="BLOCKQUOTE"===r.nodeName?r:n)&&(n.classList.add("expand"),t||ze(n,120))}Ie("dark",function(e,t,n,a){e?(S=!0,tt(),Qe()):S=!1,et(),(fe=k.matchMedia("(prefers-color-scheme: dark)").matches)===S?se.removeItem("dark"):se.setItem("dark",S?"1":"0"),z(E,"dark",!S),(n=Y("#dark"))&&(n.checked=S),K(Y("img[data-d],img[data-zd]",!1,!0),function(e,t){it(t)})}),k.webprw=st;var ut=j("div");function dt(e){if(!n){if(nt(n)&&(a=Fe(C((a=Y("#book-splash")).content)),Ne(Y("#sub-nav"),a),(e=Y("[data-template]",a,!0)).length&&K(e,function(e,t,n,a){(a=Y(n=U(t,"data-template")))?b(t,C(a.content)):t.innerHTML="template not found: "+n}),c=j("a",{class:"show-print",target:"_blank"},j("img")),(e=Array.from(Y("[data-z],[data-print]",!1,!0))).length?(imgs=[],K(e,function(e,t,n,a,r,i){if(a=U(t,"data-print"),"IFRAME"===t.nodeName||a){if(!(n=U(t,"data-z"))&&!a)return ve(t,"no src");if(D(i=J(t),"video-container")?z(i,"hide-print"):(z(t,"hide-print"),i=!1),a){try{a=JSON.parse(a)}catch(e){return}(a=He(a)?{image:a}:a).url||(a.url=n)}else{if(!(a=n.match(le))||!a[1])return;a={url:"http://youtube.com/watch?v="+a[1],image:"https://img.youtube.com/vi/"+a[1]+"/0.jpg",classes:"youtube-print"}}r=C(c,{href:a.url}),a.classes&&z(r,a.classes),requestAnimationFrame(function(){$(Y("img",r),{src:a.image})}),Ne(i||t,r)}imgs.push(t)})):imgs=e,pt(imgs),s||(s={},K(["chapter-number","chapter-block","chapter-cover"],function(e,t,n){if(!(n=Y("#book-"+t,a)))return ge("#book-"+t,a);s[t]=C(n),$(s[t],{id:null,class:"book-"+t})})),n=!1),!G)return console.info("🖨️","wait for reader index"),Ie("reader-setup-done",dt);n=!0,z(E,"book-print"),b(t=Y(".book-toc .toc",a),C(oe,{id:null})),pt(!1,t),K(x,function(e,t,n,a,r,i,o,c){i=t.readerInfo,y.test(t.nodeName)&&t.chapterIndex&&(r=i.print||{},Me(t,o=C(s["chapter-block"])),b(o,t),(c=function e(t,n,a){return a=t.previousElementSibling,1<(n=n||1)?e(a,--n):a}(o))&&"HR"===c.nodeName&&z(c,"hide-print"),i.chapter?z(o,"chapter"):i.subchapter&&z(o,"subchapter"),(nt(r.newpage)||r.newpage)&&(i.chapter||r.newpage)&&z(o,"newpage"),r.cover&&(n=C(s["chapter-cover"]),/^#/.test(r.cover)&&Y(r.cover)?b(n,C(Y(r.cover).content)):b(n,je(r.cover)),Me(t,n)),nt(r.chapter)||r.chapter)&&(b(Y("span",a=C(s["chapter-number"])),at(t.chapterIndex)),Me(t,a))}),console.info("🖨️","book print mode enabled")}}function ft(){ue=k.innerHeight,Ze(E,{"--maxheight":"calc("+ue+"px - 150px)"}),q("vp")}function pt(e,t){K(Q=e||Array.from(Y("img[data-z]",t||!1,!0)),function(e,t){rt(t)})}k.epubExport=function(m,e,t,g,r){return ct(function(t,e){requestAnimationFrame(function(){requestAnimationFrame(function(){requestAnimationFrame(function(d,f){function p(e){K(Y("img",e,!0),function(e,t,n){n=C(f,{href:t.src.toString()}),$(t,{src:n.href.toString()})})}function e(e,t){t=!!o,K(Y("img[data-z]",e,!(o=!1)),function(e,t){rt(t),$(t,{"data-z":null,"data-zd":null})}),o=!!t}f=j("a"),g=C(Y("#main-content")),K(Y("iframe,script,style,.video-container,.hide-print,.donate-big",g,!0),function(e,t){Ce(t)}),p(g),e(g),K(Y("[data-reader-info],[data-reader-link]",g,!0),function(e,t){$(t,{"data-reader-info":null,"data-reader-link":null})});var h=[];m=C(Y(".book-splash")),K(Y(".chapter",m,!0),function(e,t,n,a,r,i,o,c,s,l){if((n=U(Y("a",t),"href"))&&-1!==n.indexOf("#")&&(r=n.toString().trim().replace(/^\#/,"")+".xhtml",$(Y("a",t),{href:r}),a=Y(n,g))){for(o=qe(a=D(J(a),"book-chapter-block")?J(a):a),b(i=j("div"),a);o&&!D(o,"chapter");)(D(o,"subchapter")||D(o,"reader-link"))&&(s=o.id,s=Y(".subchapter",o)?Y(".subchapter",o).id:s)&&(l=Y('a[href*="#'+s+'"]',m))&&$(l,{href:r+"#"+s}),c=qe(o),b(i,o),o=c;var u;p(i),a=i,u=r,K(Y('a.chapter-link,a[href*="'+w.location.pathname.split("#")[0]+'#"],a[href^="#"]',a,!0),function(e,t){D(t,"chapter-link")&&(t.href="#"+U(t,"data-chapter-id")),d=C(f,{href:t.href}),$(t,{href:u+"#"+t.href.split("#")[1]})}),h.push({title:Y("span.text",t).innerHTML,content:i.innerHTML,filename:r,id:n})}}),K(Y("li.active",m,!0),function(e,t){z(t,"active",!0)}),0<h.length&&(e(d=j("div",null,C(Y("#footer")))),p(d),h[h.length-1].content+=d.innerHTML),K(d=Y("template.epub",!(r=[]),!0),function(e,t,n,a){n=U(t,"data-id"),r[n]=C(t.content).innerHTML}),$(Y(".reader-index",m),{id:"toc","epub:type":"toc"}),e(m),p(m),t({chapters:h,tocHTML:m.innerHTML,templates:r})})})})})},k.tocExport=function(){return ct(function(r,e){requestAnimationFrame(function(){requestAnimationFrame(function(){requestAnimationFrame(function(e,a){a=j("a");var t,n=C(Y(".book-splash .toc"));K(Y("li.active",n,!0),function(e,t){z(t,"active",!0)}),K(Y("a",n,!0),function(e,t){t.href&&$(t,{href:t.href.toString()})}),t=!!o,K(Y("img[data-z]",n,!(o=!1)),function(e,t){rt(t),$(t,{"data-z":null,"data-zd":null})}),o=!!t,K(Y("img",n,!0),function(e,t,n){n=C(a,{href:t.src.toString()}),$(t,{src:n.href.toString()})}),r({toc:n.innerHTML})})})})})},F(["resize","orientationchange"],function(e){ft()},k);var ht,mt={scroll:!1,time:!1},gt=F("scroll",function(e){mt.scroll||(mt.scroll=!0,gt())},k);function vt(t){if(ht)t&&t();else{if(!1===ht)return Ie("recaptcha",function(){t&&t()});ht=!1,$async("https://www.google.com/recaptcha/api.js?render=explicit").then(function(e){e=setInterval(function(){grecaptcha&&(ht=!0,e)&&(clearTimeout(e),grecaptcha.ready(function(){t&&t(),q("recaptcha")}))},0)})}}setTimeout(function(){},3e3),Ie("read-status",function(e){mt[e]=!0}),k.resolveImgs=function(){return ct(function(e,t,n,a){var r=[];K(Y("img[data-z]",!1,!0),function(e,t,n){t.webp_resolved&&!t.complete&&r.push(ct(function(t,e){De(["load","error"],function(e){t()},target,n)}))}),r.length?(a=setTimeout(function(){n||(n=!0,e())},1e4),Promise.all(r).then(function(){a&&clearTimeout(a),n||(n=!0,e())})):e()})},k.commentSubmit=function(e){Y("#comment-form").submit()},F(),-1!==document.cookie.indexOf("ebook-pdf-printer=")&&(_=!0),function e(t){"complete"===(state=w.readyState)||"interactive"===state?t():requestAnimationFrame(function(){e(t)})}(function(){var n,a,r;v=w.body,_&&pt(),ft(),Ve(function(e,t){e.isIntersecting&&!n&&(_||($async("/css/comment.css"),vt(function(e){K(Y("form.comment .g-recaptcha",!1,!0),function(e,t,n,a){n=U(t,"data-sitekey"),U(t,"data-callback"),grecaptcha.render(t,{sitekey:n,callback:function(){Y("#comment-form").submit()}})})})),n=!0)},{threshold:0,rootMargin:"0px"},Y("#comment-form",!1,!0)),requestAnimationFrame(function(){"#comment-form"===w.location.hash&&ze(-1,80)});try{(S=nt(S=function(e){try{if(e=se.getItem("dark"))return"1"===e||"0"===e?parseInt(e):(JSON.parse(e),$data)}catch(e){}}())?fe:S)&&(tt(),Qe()),et()}catch(e){console.error(e)}F("change",function(e){console.log("dark mode change",e.matches),q("dark",!!e.matches)},de),F("click",function(e){q("dark",!S)},Y("#darkswitch > span")),_||(a=Ve(function(e,t){e.isIntersecting&&(it(t),a.unobserve(t),Q=Q.filter(function(e){return t!==e}))},{threshold:0,rootMargin:"0px"},Q=Array.from(Y("[data-z],[data-anim]",!1,!0))),Ie("i",function(e){K(e=O(e)?e:[e],function(e,t){Xe(t,a),Q.push(t)})}),Ve(function(e,t){!e.isIntersecting||_||r||(r=!0,$async("https://platform.twitter.com/widgets.js"))},{threshold:0,rootMargin:"0px"},Y(".twitter-tweet",!1,!0)));var t,i,o,e=w.getElementById("menubtn"),c=(e&&F("click",function(e){var t=Je({el:Y("#menucon"),class:"menu",onclose:function(){$e(!0)}});K(Y("img[data-z], [data-anim]",t.i,!0),function(e,t){it(t)}),$e()},e),Y("form.donate")),e=(c&&F("submit",function(e){""==c.querySelector("input").value&&(e.preventDefault(),alert("Please enter an e-mail address..."),c.querySelector("input").focus())},c),Y(".video-container [data-video]",!1,!0)),e=(e.length&&(F("click",function(e,t,n,a,r){for(e.preventDefault(),n=U(t=e.target,"data-video");t&&!n;)n=U(t=J(t),"data-video");z(J(t),"playing"),r={width:720,height:405,src:"https://www.youtube.com/embed/"+(n=JSON.parse(U(t,"data-video"))).id+"?autoplay=1",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0},a=j("iframe",r=n.attrs?Object.assign(r,n.attrs):r),J(e=t).replaceChild(a,e)},e),K(e,function(e,t,n){z(J(t),"imgplay")})),k.IntersectionObserver&&(e=Y("#sub-nav"),new k.IntersectionObserver(function(e){e=e[0];e.target.classList.toggle("isSticky",e.intersectionRatio<1)},{threshold:[1],rootMargin:"-1px 0px 0px 0px"}).observe(e)),Y('meta[http-equiv="content-language"]'),Y("blockquote .expandlink",!1,!0)),e=(e&&e.length&&e.forEach(function(t){F("click",function(e){e.preventDefault(),lt(t)},t);var e=t.getAttribute("data-hash");e&&w.location.hash&&w.location.hash.split("#")[1]===e&&lt(t)}),Y(".rightsnature")),e=(e&&(e.onclick=function(){gtag("event","newsletter_rightsfornature",{event_category:"newsletter",event_label:"Newsletter Rights for Nature"})}),Y('a[target="_blank"]',!1,!0)),e=(e&&e.length&&F("click",function(e){gtag("event","ext_link",{event_category:el.classList.contains("quote")?"quote":"other",event_label:el.href})},e),Y("p.donate a",!1,!0));e&&e.length&&w.getElementById("donate")&&(F("click",function(e){e.preventDefault(!0),ze(w.getElementById("donate"),80),gtag("event","donate_button",{event_category:"donate",event_label:"Donate Button"})},e),Y("form.donate input").onfocus=Y("form.donate input").onkeypress=function(e){t&&clearTimeout(t),t=setTimeout(function(){gtag("event","donate_form_entry",{event_category:"donate",event_label:"Donate Form Email Entry"})},1e3)}),F(["beforeprint","afterprint"],function(e){q("print",!("afterprint"===e.type))},k);var s,e=k.matchMedia("print"),e=(F("change",function(e){q("print",!!e.matches)},e),Ie("print",function(e,t){if(e){if(_=!0,o)return;o=!0,dt(),i=S,q("dark",!1),console.info("🖨️","print view enabled")}else{if((_=!1)===o)return;o=!1,q("dark",S=i)}e=Array.from(Y('a[href^="/"]',Y("#main-content"),!0));e.length&&(ve(e,window.articleSlug),imgs=[],K(e,function(e,t,n,a,r,i){_?(a=(n=U(t,"href")).match(/^\/([^\/]+)\/(\#.*)?$/))&&a[1]!==window.articleSlug&&$(t,{"data-href":n,href:"/book/"+a[1]+".html"}):(n=U(t,"data-href"))&&$(t,{href:n})}))}),e.matches&&q("print",!0),W=Y("#reader"),L=Y(".reader-container"),w.body.appendChild(L),Z=W.getAttribute("data-foreword"),ee=W.querySelector(".index-btn"),te=W.querySelector(".status > .cur"),ne=te.querySelector("span.chapter"),ae=te.querySelector("span.subchapter"),A=W.querySelector(".status > .next"),T=A.querySelector("a.prev"),I=A.querySelector("a.next"),re=A.querySelector("span.chapter"),ie=A.querySelector("span.subchapter"),oe=Y("#reader-index"),F("click",function(e){e.preventDefault();var t=e.target===T?"prev":"next";e.target===T&&A.classList.contains("no-prev")||e.target===I&&A.classList.contains("no-next")||(Pe(e.target),gtag("event","reader_"+t,{event_category:"reader_nav",event_label:t+" nav"}))},[T,I]),Y(".reader-index .ebook-download")),l=Y("button",e),u=Y("input",e),d=(F("click",function(e,t){e.preventDefault(),Ye(!1,e.target===u)},[l,u]),ebook_download_setup=!1,Array.from(Y(".reader-index,.download-index",L,!0))),e=(F("click",function(e){var t=e.target;if(t){if(-1===d.indexOf(t)&&!D(t,"reader-container"))for(;t!==v;){if(D(t,"reader-container")||D(t,"popup-w"))return;if(!(t=J(t)))return}R(!1)}},v),F("click",function(e){e.preventDefault(),e.stopPropagation(),R("index"),s||(pt(),s=!0)},ee),Y("#select-lg")),l=(e&&F("click",function(e){e.preventDefault(),e.stopPropagation(),R("lg")},e),Y("#download")),e=(l&&!ot(l,"data-no-download")&&F("click",function(e,t){for(e.preventDefault(),e.stopPropagation(),t=e.target;"A"!==t.nodeName&&t!==v;)t=J(t);Ye()},[l]),Y("#show-social")),l=(e&&F("click",function(e){e.preventDefault(),e.stopPropagation(),Ue(),function t(n){gtag("event",n?"social_close":"social_open",{event_category:"social",event_label:n?"Close social share":"Open social share"}),R(!1),Ue(),requestAnimationFrame(function(){var e;n?(z(E,["noscroll","reader-win"],!0),Ge([M,N])):(e=Je({el:Y("#social-popup"),class:"social-popup light-o",onclose:function(){t(!0)}}),Y(".layer",M).scrollTo(0,0),K(Y("img[data-z], [data-anim]",e.i,!0),function(e,t){it(t)}))})}()},e),Y(".main")),f=[".reader-link"];if(["h1","h2","h3","h4","h5","p"].forEach(function(e){f.push(e+".chapter,"+e+".subchapter")}),D(v,"no-reader"))x=[];else{if(0===(x=Array.from(l.querySelectorAll(f.join(",")))).length){var p=1,e=l.querySelectorAll("h1.bighead");if(0===e.length&&(p=2,e=l.querySelectorAll("h2.bighead")),0===e.length&&(p=3,e=l.querySelectorAll("h3.bighead")),0<e.length){hbig=Array.from(l.querySelectorAll(".bighead")),e=Array.from(e),h1first=hbig.indexOf(e[0]);for(var h=[],m=1;m<=5;m++)m<=p||h.push("h"+m+".bighead");h.length&&(h2big=l.querySelectorAll(h.join(","))),e.forEach(function(e){e.classList.add("chapter")}),h2big.length&&(h2big=Array.from(h2big)).forEach(function(e){var t=hbig.indexOf(e);e.classList.add(t<h1first?"chapter":"subchapter")})}x=Array.from(l.querySelectorAll(f.join(",")))}F("click",function(e,t,n){for(e.preventDefault(),t=e.target;"A"!==t.nodeName;)t=t.parentElement;(n=Y(t.getAttribute("data-chapter-link")))&&(Pe(n),gtag("event","reader_link_"+n.id,{event_category:"reader_link_selection",event_label:P(n)}))},l.querySelectorAll("[data-chapter-link]"))}if(0===x.length)z(W,"nochapters");else{var b,e=w.documentElement.getAttribute("lang");try{b=new Intl.NumberFormat(e,{minimumFractionDigits:0,maximumFractionDigits:0})}catch(e){}var y=w.createElement("li"),l=w.createElement("a"),e=w.createElement("span"),g=w.createElement("span");z(e,"num"),g.classList.add("text"),l.appendChild(e),l.appendChild(g),y.appendChild(l),requestAnimationFrame(function(){for(var t,e,n,a,r,i,o,c,s,l,u,d=[],f=0,p={},h=0,m=x.length;h<m;h++){if((tag=x[h]).id||(tag.id="_h"+h),tag.type=!1,tag.index=h,tag.setAttribute("data-index",h),u=c=s=!1,i=tag.classList.contains("chapter")?(d=[[++f,0]],o=!(r=!0)):(r=!1,o=(o=tag.getAttribute("data-level"))&&parseInt(o),tag.classList.contains("subchapter")),e=(t=y.cloneNode(!0)).querySelector("a"),n=e.querySelector("span.num"),a=e.querySelector("span.text"),tag.classList.contains("reader-link")){s=!0;try{c=JSON.parse(tag.getAttribute("data-reader-link"))}catch(e){console.error(e);continue}c.level&&(o=c.level),c.classes&&(u=c.classes instanceof Array?c.classes:[c.classes]),a.innerHTML=c.title||tag.innerHTML,c.chapter?(tag.readerInfo=c,a.innerHTML=(c.emoji?"<span class=e"+(c.emoji_anim?' data-anim="'+c.emoji_anim+'"':"")+">"+c.emoji+"</span> ":"")+(c.title||tag.innerHTML),tag.chapterTitle=a.innerHTML,o=!(r=!(s=!(d=[[++f,0]])))):c.subchapter?(i=!0,tag.readerInfo=c,a.innerHTML=(c.emoji?"<span class=e"+(c.emoji_anim?' data-anim="'+c.emoji_anim+'"':"")+">"+c.emoji+"</span> ":"")+(c.title||tag.innerHTML),tag.chapterTitle=a.innerHTML,s=!1):(t.classList.add("reader-link"),tag.readerInfo=c,tag.type="link",tag.chapterTitle=(c.emoji?"<span class=e"+(c.emoji_anim?' data-anim="'+c.emoji_anim+'"':"")+">"+c.emoji+"</span> ":"")+" "+a.innerHTML)}else{if(tag.hasAttribute("data-reader-info"))try{c=JSON.parse(tag.getAttribute("data-reader-info"))}catch(e){console.error(e);continue}c?(c.level&&(o=c.level),tag.readerInfo=c,a.innerHTML=(c.emoji?"<span class=e"+(c.emoji_anim?' data-anim="'+c.emoji_anim+'"':"")+">"+c.emoji+"</span> ":"")+(c.title||tag.innerHTML),tag.chapterTitle=a.innerHTML,c.classes&&(u=c.classes instanceof Array?c.classes:[c.classes])):(tag.chapterTitle=tag.innerHTML,a.innerHTML=tag.innerHTML)}var g=w.createElement("div");if(g.innerHTML=tag.chapterTitle,tag.chapterTitleText=tag.readerInfo&&tag.readerInfo.titleText?tag.readerInfo.titleText:g.innerText,tag.readerInfo&&tag.readerInfo.indexTitle&&(a.innerHTML=c.indexTitle),tag.readerInfo&&tag.readerInfo.emoji_anim&&(rt(Y("[data-anim]",g=C(ut,null,je(tag.chapterTitle))),!0),tag.chapterTitle=g.innerHTML),isNaN(o)||!1===o||o--,o<0&&(o=0),tag.readerInfo||(tag.readerInfo={}),tag.readerInfo.level=o,r||tag.readerInfo.chapter?tag.readerInfo.chapter=!0:(i||tag.readerInfo.subchapter)&&(tag.readerInfo.subchapter=i),r)t.classList.add("chapter"),n.innerHTML=(b?b.format(f):f)+".",tag.chapterIndex=n.innerHTML;else{if(void 0===d[o]&&(void 0===d[o-1]?(console.error("invalid parent",tag,d,o),d[o]=[-1,0]):d[o]=[d[o-1][1],0]),s)n.innerHTML="&nbsp;",z(a_num_sub=n.cloneNode(!0),"e"),a_num_sub.innerHTML=c.emoji||"📌",c.emoji&&c.emoji_anim&&$(a_num_sub,{"data-anim":c.emoji_anim}),n.parentNode.insertBefore(a_num_sub,n.nextSibling);else{for(;d[o+1];)d.pop();d[o][1]++,l=[],d.reverse().forEach(function(e){(a_num_sub=n.cloneNode(!0)).innerHTML=(b?b.format(e[1]):e[1])+".",n.parentNode.insertBefore(a_num_sub,n.nextSibling),l.push(a_num_sub.innerHTML)}),d.reverse(),n.innerHTML=(b?b.format(d[0][0]):d[0][0])+".",l.reverse(),l.unshift(n.innerHTML),tag.chapterIndex=l.join("")}t.classList.add("subchapter"),u&&u.forEach(function(e){t.classList.add(e)}),0<o&&t.classList.add("l"+(o+1))}$(e,{"data-index":h,href:(p[tag.id]=tag).readerInfo&&tag.readerInfo.link?tag.readerInfo.link:"#"+tag.id}),oe.appendChild(t)}imgs=Array.from(Y("img[data-d],img[data-z],img[data-zd],[data-anim]",oe,!0)),q("i",imgs);var v=Array.from(Y("a.chapter-link",!1,!0));K(v,function(e,t,n,a,r){n=U(t,"data-chapter-id"),(a=p[n])&&((r=Y("span",t))&&(r.innerHTML=a.chapterIndex),$(t,{"data-index":U(a,"data-index"),title:a.chapterTitleText}))}),ce=Array.from(oe.querySelectorAll("[data-index]")),w.location.hash&&function(){var n;try{if(!(n=Y(w.location.hash.toString())))return;var e=B(n);if(isNaN(e)||!1===e)return;n=x[e]}catch(e){return console.error("hash",e)}function t(){var e,t=n.readerInfo;t&&t.expand&&(e=Y(t.expand))&&(lt(e,!0),t.expand=!1),ze(n,80,{})}pt();e=n.chapterTitleText||n.innerText;k.history&&k.history.replaceState("",e,w.location.pathname+"#"+n.id),w.title=e,t(),requestAnimationFrame(function(){t()}),setTimeout(function(){t()},1e3)}(),v.length&&F("click",function(e){e.preventDefault();for(var t=e.target;!t.classList.contains("chapter-link")&&"A"!==t.tagName;)t=t.parentElement;var e=B(t);isNaN(e)||!1===e||(e=x[e],Pe(t),gtag("event","reader_chapter_link_"+e.id,{event_category:"reader_chapter_link",event_label:P(e)}))},v),F("click",function(e){e.preventDefault();for(var t=e.target;!t.classList.contains("reader-link")&&"A"!==t.tagName;)t=t.parentElement;var n,e=B(t);isNaN(e)||!1===e||((n=(e=x[e]).readerInfo)&&n.link?n.target&&"_blank"===n.target?k.open(n.link):w.location.href=n.link:(Pe(t),gtag("event","reader_index_"+e.id,{event_category:"reader_index_selection",event_label:P(e)})))},ce),G=!0,q("reader-setup-done")}),F("scroll",function(){var e=k.scrollY/(v.offsetHeight-k.innerHeight)*100;requestAnimationFrame(function(){Ze(W,{"border-image-source":"linear-gradient(to right, var(--readerbarfill) "+e+"%, var(--readerbar) 0%)"})}),V||Be()},window),F("wheel",function(e){we&&clearTimeout(we),H&&H(),V=!1},window),F("keydown",function(e){if(Ae){if("Escape"===event.key)return R(!1);var t;"index"===Ae&&(t=oe.parentElement,"ArrowUp"===event.key?t.scrollTop-=50:"ArrowDown"===event.key&&(t.scrollTop+=50))}},w),Be(),F("keydown",function(e){if(-1!==["INPUT","TEXTAREA","SELECT"].indexOf(e.target.tagName)||e.altKey||e.ctrlKey)return!1;var t;37==e.keyCode?k.pageXOffset<=0&&(e.preventDefault(),0===(t=B(T))&&X&&B(X)===t?(ze(),X=!1):Pe(T)):39==e.keyCode&&w.body.scrollWidth-k.innerWidth<=k.pageXOffset&&(e.preventDefault(),Pe(I))},w)}_&&dt(),"#print"===w.location.hash&&R("download",0,!0)})}(window,document);